<h2>My Wins</h2>

<menu id="filter-container" class="hide">
  <%= button_tag "âœ•", id: "close-filter-btn" %>

  <h3>Filter</h3>
  <%= form_with(url: filter_path, method: :post, id: "wins-filter") do |form| %>
    <fieldset id="date-filter">
      <%= form.label :from %>
      <%= form.date_select :date_start, options = { order: [:day, :month, :year], use_short_month: true, selected: Date.parse(session[:date_start]), start_year: Date.today.year - 5, end_year: Date.today.year } %>

      <%= form.label :to %>
      <%= form.date_select :date_end, options = { order: [:day, :month, :year], use_short_month: true, selected: Date.parse(session[:date_end]), start_year: Date.today.year - 5, end_year: Date.today.year } %>
    </fieldset>

    <fieldset id="category-filter">
      <%= form.label :category %>
      <% @categories.each do |category| %>
        <span class="checkbox-option">
          <%= check_box_tag(category, 1, session[:categories].include?(category)) %>
          <%= label_tag(category, category) %>
        </span>
      <% end %>
    </fieldset>

    <%= form.submit "Filter", id: "submit-filter-btn" %>
    <%= link_to "Reset", reset_filter_path, id: "reset-filter-btn" %>
  <% end %>
</menu>

<%= button_tag image_tag("filter-icon.png", class: "small-icon"), id: "open-filter-btn" %>

<section id="win-summary">
    <p>Results: <%= pluralize(session[:total_filtered_wins], "win") %></p>
    <%= button_to "+ Add win", new_user_win_path(@user), method: :get , id: "add-win-btn" %>
</section>

<section id="card-container">
  <% @wins.each do |win| %>
    <%= link_to user_win_path(id: win.id) do %>
    <article class="card <%= win.category %>">
      <div class="card-logo">
        <%= image_tag("card-icon-#{win.category}.png", alt: "profile icon", class: "medium-icon card-icon" ) %>
        <h4 class="card-category"><%= win.category %></h4>
      </div>
      <p class="card-date"><%= format_date(win.accomplished_date) %></p>
      <h3 class="card-title"><%= win.title %></h3>
    </article>
    <% end %>
  <% end %>
</section>

<%= pagy_nav(@pagy).html_safe %>

<script>
  function toggleFilter() {
    const filterContainer = document.querySelector("#filter-container");

    filterContainer.classList.toggle('hide');
    filterContainer.classList.toggle('show');
  }

  document.querySelector("#open-filter-btn").addEventListener('click', toggleFilter)
  document.querySelector("#close-filter-btn").addEventListener('click', toggleFilter)
</script>
