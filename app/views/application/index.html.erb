<% if session[:signed_in] %>
  <!-- Filter toggle -->
  <div id="filterPanel" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="closeFilter()">&times;</a>
    <form class="pure-form pure-form-stacked date-filter" action="/filter" method="post">
      <fieldset>
        <h2>Filter</h2>
        <label for="date-start">From</label>
        <input type="date" name="date_start" min="<%= session[:earliest_win_date] %>" max="<%= session[:current_date] %>" value="<%= session[:date_start] ||= session[:earliest_win_date] %>">
        <label for="date-end">To</label>
        <input type="date" name="date_end" min="<%= session[:earliest_win_date] %>" max="<%= session[:current_date] %>" value="<%= session[:date_end] ||= session[:current_date] %>">
        <label for="sort_by">Sort by:</label>
        <select name="sort_by"><% current_sort_by = session[:sort_by] ||= 'DESC' %> <option value="DESC" <%= selected_option('DESC', current_sort_by) %>>newest to oldest </option>
          <option value="ASC" <%= selected_option('ASC', current_sort_by) %>>oldest to newest </option>
        </select><br><br>
        <button type="submit" class="pure-button pure-button-primary">Filter wins</button><br><br>
        <a href="/reset">Reset filter</a>
      </fieldset>
    </form>
  </div>

  <!-- Main container div -->
  <div class="pure-g">

    <!-- Left container div -->
    <div class="pure-u-2-3">
      <h2>My Wins</h2>
      <% if session[:wins_array].empty? %>
        <p>It looks like you haven't added any wins yet.</p><br><br>
        <a href="/add">
          <button class="pure-button"> &#10133; Add a win</button>
        </a>
      <% else %>
        <span onclick="openFilter()">
        <img id="filter-icon" src="/images/filter-icon.png"> Filter </span>
        <p style="display: inline; padding-left: 50px;">Results: <%= session[:num_wins] %> wins </p>
        <a href="/add">
          <button class="pure-button" id="add-new-win-btn"> &#10133; Add a win</button>
        </a>
        <!-- Card summary div -->
        <div class="pure-g" style="padding: 20px;"><% session[:wins_array].each do |win| %> <div class="pure-u-1-3">
          <a class="card-link" href="/wins/<%= session[:user_id] %>/<%= win[:id] %>">
            <div class="card <%= win[:category] %>">
              <img src="/images/card-icon-<%= win[:category] %>.png">
              <p id="card-category"><%= win[:category] %> </p>
              <p id="card-title"><%= win[:title] %> </p>
              <p id="card-date"><%= format_date(win[:date_added]) %> </p>
            </div>
          </a>
        </div>
      <% end %>
    </div>

    <div class="pure-u-1" id="card-nav">
      <%== page_nav_url(session[:current_page], session[:num_wins], 'back') %>
      <p><%= filtered_results_num(session[:current_page], session[:num_wins]) %></p>
      <%== page_nav_url(session[:current_page], session[:num_wins], 'forward') %>
    </div>
    <div class="pure-u-1-3"></div>
  </div>

  <!-- Right container div -->
  <div class="pure-u-1-3">
    <% if @current_win %>
      <!-- Card detail div -->
      <div class="pure-u-1 card card-detail <%= @current_win[:category] %>">
        <img id="detail-category-img" src="/images/card-icon-<%= @current_win[:category] %>.png">
        <p id="card-category"><%= @current_win[:category] %> </p>
        <h3 id="card-title"><%= @current_win[:title] %> </h3>
        <p id="card-content"><%= @current_win[:description] %> </p>
        <p id="card-date"><%= format_date(@current_win[:date_added]) %> </p>
        <!-- Card edit menu -->
        <div class="win-update">
          <form onsubmit="return confirm('Are you sure you want to delete this?');" class="delete" method="post" action="/delete/<%= session[:user_id] %>/<%= @current_win[:id] %>">
            <button type="submit" class="tooltip">
              <img src="/images/trash-icon.png">
              <span class="tooltiptext">Delete this win</span>
            </button>
          </form>
          <a href="/edit/<%= session[:user_id] %>/<%= @current_win[:id] %>" class="tooltip">
            <img src="/images/edit-icon.png">
            <span class="tooltiptext">Edit this win</span>
          </a>
        </div>
      </div>
    <% end %>
  </div> <!-- End of main container div -->
<% end %>

<% else %>
  <h2>Hello!</h2>
  <p>Please <a href="/sign_in">sign in</a> or <a href="users/new">create an account</a></p>
<% end %>
